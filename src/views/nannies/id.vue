<template>
    <div class="nanny-profile-container" v-motion-fade >
      <navbar-interactive
        rootClassName="navbar-interactive-root-class-name2"
      ></navbar-interactive>
      <div class="nanny-profile-container01">
        <div class="nanny-profile-container02">
          <div class="nanny-profile-container03"  >
            <app-back rootClassName="back-root-class-name2"></app-back>
            <div  v-if="!reviewVisible" class="nanny-profile-container04">
              <img
                alt="image"
                :src="nanny.avatar"
                loading="lazy"
                class="nanny-profile-image"
              />
              <span  v-if="!reviewVisible" class="nanny-profile-text">
                <span class="nanny-profile-text01">{{ nanny.name.split(" ")[0] }}</span>
                &nbsp
                <span class="nanny-profile-text02">{{ nanny.name.split(" ")[1] }}</span>
              </span>
            </div>
            <div  v-if="!reviewVisible" class="nanny-profile-container05">
              <span class="nanny-profile-text03">
                <span class="nanny-profile-text04">- Age:</span>
                <span class="nanny-profile-text05">  {{ age }}</span>
              </span>
            </div>
            <div  v-if="!reviewVisible" class="nanny-profile-container06">
              <span class="nanny-profile-text06">
                <span class="nanny-profile-text07">- Phone:</span>
                <span class="nanny-profile-text08">  +237 {{ nanny.phone }}</span>
              </span>
            </div>
            <div  v-if="!reviewVisible" class="nanny-profile-container07">
              <span class="nanny-profile-text09">
                <span class="nanny-profile-text10">- Location:</span>
                <span class="nanny-profile-text11"> </span>
                <span class="nanny-profile-text12">{{ nanny.location }}</span>
              </span>
            </div>
            <span  v-if="!reviewVisible" class="nanny-profile-text13">
              <span class="nanny-profile-text14">About </span>
              <span class="nanny-profile-text15">me </span>
            </span>
            <span v-if="!reviewVisible" class="nanny-profile-text16">
            {{ nanny.bio }}
            </span>
            <span @click="toggleReview()" class="nanny-profile-text17">
              <span>Re</span>
              <span class="nanny-profile-text19">vi</span>
              <span>ews</span>
            </span>
<div v-if="reviewVisible" v-for="review in reviews" :key="review.id">
            <div class="nanny-profile-container08" v-if="true">
              <span class="nanny-profile-text21">@{{ review.name }}</span>
              <span class="nanny-profile-text22">
               {{ review.message }}
              </span>
            </div>
          </div>

          <div
            class="start-container40" v-if="reviewVisible" v-slide-left> 
            <div>
    <v-text-field
    variant="outlined"
      v-model="clientName"
      label="Your Name"
    ></v-text-field>
<br>
    <v-textarea
    variant="outlined"
      v-model="msg"
      label="Your Review"
    ></v-textarea>


<div class="errorClass" v-if="error1.visible">
  {{ error1.message }}
</div>

<v-btn :loading="loading" color="blue-lighten-1" @click="validateForm1" class="login-find button">
              <span>
                <span class="login-text09">Submit</span>
                <br />
              </span>
            </v-btn>
     </div>
    </div>

          


            <div class="nanny-profile-container09" v-if="false">
              <span class="nanny-profile-text23">@Mrs Sharon Dinkeng</span>
              <span class="nanny-profile-text24">
                She is very respectful and efficient. She did all her chores without
                me having to control anything
              </span>
            </div>
            <button v-if="isLoggedIn" 
            @click="router.push(`${id.params.id}/edit-profile`)"
             class="nanny-profile-find button">
             <span> <v-icon name="fa-pencil-alt"></v-icon></span>
             &nbsp
            <span>edit profile</span> </button>

            <button
            @click="router.push(`${id.params.id}/recruit`)"

             v-else class="nanny-profile-find button">Recruit Now</button>
          
          </div>           
    </div>
      </div>
      <app-footer rootClassName="footer-root-class-name2"></app-footer>
    </div>
  </template>
  
  <script setup>
  import NavbarInteractive from '@/components/navbar-interactive.vue'
  import AppBack from '@/components/back.vue'
  import AppFooter from '@/components/footer.vue'
  import { useRoute, useRouter } from 'vue-router';
  import { ref, onMounted, reactive } from 'vue';
  import { database } from '../../supabase';

  const id = useRoute()
  const router = useRouter()

  const error1 = reactive({message:'', visible:false})
  const nannies = JSON.parse(localStorage.getItem('@nannies')) 

  const clientName = ref('')
  const msg = ref('')
  const loading=ref(false)

   async function validateForm1(){
    if(clientName.value === '')
    {
      error1.message='name cannot be empty'
      error1.visible = true      
    }
    else
    if(msg.value === ''){
      error1.message='message cannot be empty'
      error1.visible = true     
    }
    else {
      try {
        loading.value= true
        await database
        .from('comments2')
        .insert({
          name: clientName.value,
          message: msg.value,
          nannyId: id.params.id,
        })
        getReviews();
        loading.value = false
      } catch (error) {
        console.log(error)
      }
    }

  }
  //console.log('nannies: ',nannies)

  const nanny = nannies.filter(n => n.id == id.params.id)[0]
  //console.log('nanny', nanny)
  const today = new Date()
  const dob = new Date(nanny.dob)
  const age = dob.getYear() - today.getYear()
  //console.log('age: ',age)

  const loggedName = localStorage.getItem('@name')
  const loggedPassword = localStorage.getItem('@password')

  const isLoggedIn = ref(false)

  const reviewVisible = ref(false)
  function toggleReview (){
    reviewVisible.value = !reviewVisible.value
  }

  const reviews = ref()

  async function getReviews(){
try {
  const {data} = await database
  .from('comments2')
  .select('*')
  .eq('nannyId', id.params.id)
  
  reviews.value = data

} catch (error) {
  
}
  }

  onMounted(() => {
    localStorage.setItem('@selectedNanny', nanny.name)
    getReviews();
    if((loggedName === nanny.name)&&(loggedPassword === nanny.password)) {
      isLoggedIn.value = true
    }
  })  

  </script>
  
  <style scoped>
  .nanny-profile-container {
    width: 100%;
    display: flex;
    overflow: auto;
    min-height: 100vh;
    align-items: center;
    flex-direction: column;
    justify-content: flex-start;
  }
  
  .start-container40 {
    width: 100%;
    height: auto;
   padding: 3vw;
    border-radius: 24px;
    margin-top:  var(--dl-space-space-oneandhalfunits) ;
    margin-bottom: var(--dl-space-space-twounits);
    background-color: #ffffff;
  }
  .nanny-profile-container01 {
    width: 100%;
    height: 1154px;
    display: flex;
    align-items: center;
    flex-direction: column;
    background-size: cover;
    justify-content: flex-start;
    background-image: url('https://upload.wikimedia.org/wikipedia/commons/c/c0/Salon_Shop.jpg');
    background-repeat: no-repeat;
    background-position: center;
  }
  .nanny-profile-container02 {
    width: 100%;
    height: 1156px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: rgba(0, 0, 0, 0.36);
  }
  .nanny-profile-container03 {
    flex: 0 0 auto;
    width: 844px;
    height: 1091px;
    display: flex;
    box-shadow: 5px 5px 10px 0px #d4d4d4;
    align-items: center;
    border-radius: var(--dl-radius-radius-radius8);
    margin-bottom: 12px;
    flex-direction: column;
    justify-content: flex-start;
    background-color: #ffffff;
  }
  .nanny-profile-container04 {
    width: 100%;
    height: 274px;
    display: flex;
    align-items: center;
    padding-top: var(--dl-space-space-twounits);
    padding-bottom: 13px;
    justify-content: center;
  }
  .nanny-profile-image {
    width: 20vw;
    height: 20vw;
    object-fit: cover;
    border-color: var(--dl-color-primary-500);
    border-width: 5px;
    margin-right: var(--dl-space-space-threeunits);
    border-radius: var(--dl-radius-radius-round);
  }
  .nanny-profile-text {
    font-size: 32px;
    font-style: normal;
    margin-top: var(--dl-space-space-halfunit);
    font-family: Poppins;
    font-weight: 700;
  }
  .nanny-profile-text01 {
    color: #000000;
  }
  .nanny-profile-text02 {
    color: rgb(152, 0, 217);
  }
  .nanny-profile-container05 {
    width: 50%;
    height: 47px;
    display: flex;
    align-self: center;
    margin-top: var(--dl-space-space-unit);
    align-items: center;
    justify-content: flex-start;
  }
  .nanny-profile-text03 {
    font-size: 21px;
    font-family: Poppins;
    font-weight: 600;
  }
  .nanny-profile-text04 {
    color: #000000;
  }
  .nanny-profile-text05 {
    color: rgb(152, 0, 217);
  }
  .nanny-profile-container06 {
    width: 50%;
    height: 47px;
    display: flex;
    align-self: center;
    align-items: center;
    justify-content: flex-start;
  }
  .nanny-profile-text06 {
    font-size: 21px;
    font-family: Poppins;
    font-weight: 600;
  }
  .nanny-profile-text07 {
    color: #000000;
  }
  .nanny-profile-text08 {
    color: rgb(152, 0, 217);
  }
  .nanny-profile-container07 {
    width: 50%;
    height: 47px;
    display: flex;
    align-self: center;
    align-items: center;
    justify-content: flex-start;
  }
  .nanny-profile-text09 {
    font-size: 21px;
    font-family: Poppins;
    font-weight: 600;
  }
  .nanny-profile-text10 {
    color: #000000;
  }
  .nanny-profile-text11 {
    color: rgb(152, 0, 217);
  }
  .nanny-profile-text12 {
    color: rgb(152, 0, 217);
  }
  .nanny-profile-text13 {
    font-size: 32px;
    font-style: normal;
    margin-top: var(--dl-space-space-threeunits);
    font-family: Poppins;
    font-weight: 700;
  }
  .nanny-profile-text14 {
    color: #000000;
  }
  .nanny-profile-text15 {
    color: rgb(152, 0, 217);
  }
  .nanny-profile-text16 {
    font-size: 18px;
    align-self: center;
    margin-top: var(--dl-space-space-halfunit);
    text-align: justify;
    font-family: Poppins;
    line-height: 1.3;
    margin-left: var(--dl-space-space-fiveunits);
    margin-right: var(--dl-space-space-fiveunits);
  }
  .nanny-profile-text17 {
    font-size: 32px;
    font-style: normal;
    margin-top: var(--dl-space-space-threeunits);
    font-family: Poppins;
    font-weight: 700;
  }
  .nanny-profile-text19 {
    color: rgb(152, 0, 217);
  }
  .nanny-profile-container08 {
    flex: 0 0 auto;
    width: 675px;
    height: 100px;
    display: flex;
    box-shadow: 5px 5px 10px 0px #d4d4d4;
    margin-top: var(--dl-space-space-oneandhalfunits);
    align-items: flex-start;
    flex-direction: column;
    justify-content: flex-start;
    background-color: #f1f1f1;
  }
  .nanny-profile-text21 {
    font-size: 18px;
    align-self: flex-start;
    font-style: normal;
    margin-top: var(--dl-space-space-unit);
    font-family: Poppins;
    font-weight: 600;
    margin-left: var(--dl-space-space-unit);
  }
  .nanny-profile-text22 {
    font-size: 15px;
    align-self: flex-start;
    font-style: normal;
    margin-top: var(--dl-space-space-halfunit);
    font-family: Poppins;
    font-weight: 400;
    margin-left: var(--dl-space-space-unit);
  }
  .nanny-profile-container09 {
    flex: 0 0 auto;
    width: 675px;
    height: 100px;
    display: flex;
    box-shadow: 5px 5px 10px 0px #d4d4d4;
    margin-top: var(--dl-space-space-oneandhalfunits);
    align-items: flex-start;
    flex-direction: column;
    justify-content: flex-start;
    background-color: #f1f1f1;
  }
  .nanny-profile-text23 {
    font-size: 18px;
    align-self: flex-start;
    font-style: normal;
    margin-top: var(--dl-space-space-unit);
    font-family: Poppins;
    font-weight: 600;
    margin-left: var(--dl-space-space-unit);
  }
  .nanny-profile-text24 {
    font-size: 15px;
    align-self: flex-start;
    font-style: normal;
    margin-top: var(--dl-space-space-halfunit);
    font-family: Poppins;
    font-weight: 400;
    margin-left: var(--dl-space-space-unit);
  }
  .nanny-profile-find {
    color: var(--dl-color-gray-white);
    font-style: normal;
    margin-top: var(--dl-space-space-threeunits);
    transition: 0.3s;
    font-weight: 500;
    padding-top: var(--dl-space-space-unit);
    border-width: 0px;
    padding-left: var(--dl-space-space-oneandhalfunits);
    border-radius: 56px;
    padding-right: var(--dl-space-space-oneandhalfunits);
    padding-bottom: var(--dl-space-space-unit);
    background-color: rgb(152, 0, 217);
  }
  .nanny-profile-find:hover {
    opacity: 0.5;
  }
  @media(max-width: 991px) {
    .nanny-profile-container03 {
      width: 786px;
    }
    .nanny-profile-image {
      width: 25vw;
      height: 25vw;
    }
    .nanny-profile-text03 {
      font-size: 21px;
      font-style: normal;
      font-family: Poppins;
      font-weight: 600;
    }
    .nanny-profile-text04 {
      color: #000000;
      font-weight: 700;
    }
    .nanny-profile-text05 {
      color: rgb(152, 0, 217);
    }
    .nanny-profile-text06 {
      font-size: 21px;
      font-style: normal;
      font-family: Poppins;
      font-weight: 600;
    }
    .nanny-profile-text07 {
      color: #000000;
      font-weight: 700;
    }
    .nanny-profile-text08 {
      color: rgb(152, 0, 217);
    }
    .nanny-profile-text09 {
      font-size: 21px;
      font-style: normal;
      font-family: Poppins;
      font-weight: 600;
    }
    .nanny-profile-text10 {
      color: #000000;
      font-weight: 700;
    }
    .nanny-profile-text11 {
      color: rgb(152, 0, 217);
      font-weight: 700;
    }
    .nanny-profile-text12 {
      color: rgb(152, 0, 217);
    }
    .nanny-profile-text13 {
      font-size: 28px;
      font-style: normal;
      font-family: Poppins;
      font-weight: 700;
    }
    .nanny-profile-text14 {
      color: #000000;
    }
    .nanny-profile-text15 {
      color: rgb(152, 0, 217);
    }
    .nanny-profile-text17 {
      font-size: 28px;
      font-style: normal;
      font-family: Poppins;
      font-weight: 700;
    }
    .nanny-profile-find {
      width: 50%;
      text-align: center;
    }
  }
  @media(max-width: 767px) {
    .nanny-profile-container03 {
      width: 100%;
      padding-left: 7vw;
      padding-right: 7vw;
    }
    .nanny-profile-container04 {
      width: 100%;
      height: 218px;
      padding-top: 0px;
      padding-bottom: 0px;
    }
    .nanny-profile-image {
      width: 25vw;
      height: 27vw;
    }
    .nanny-profile-container05 {
      width: 60%;
    }
    .nanny-profile-container06 {
      width: 60%;
    }
    .nanny-profile-container07 {
      width: 60%;
    }
    .nanny-profile-text16 {
      margin-left: var(--dl-space-space-oneandhalfunits);
      margin-right: var(--dl-space-space-oneandhalfunits);
    }
    .nanny-profile-container08 {
      width: 100%;
    }
    .nanny-profile-container09 {
      width: 100%;
    }
  }
  @media(max-width: 474px) {
    .nanny-profile-container01 {
      height: 1348px;
    }
    .nanny-profile-container02 {
      height: 100%;
    }
    .nanny-profile-container03 {
      width: 100%;
      height: 1241px;
      padding-left: 7vw;
      margin-bottom: 0px;
      padding-right: 7vw;
    }
    .nanny-profile-container04 {
      width: 100%;
      height: 262px;
      padding-bottom: 0px;
    }
    .nanny-profile-image {
      width: 36vw;
      height: 38vw;
      margin-right: var(--dl-space-space-unit);
    }
    .nanny-profile-text {
      font-size: 28px;
    }
    .nanny-profile-container05 {
      width: 324px;
      padding-right: 0px;
    }
    .nanny-profile-container06 {
      width: 324px;
      padding-right: 0px;
    }
    .nanny-profile-container07 {
      width: 332px;
    }
    .nanny-profile-text13 {
      font-size: 26px;
    }
    .nanny-profile-text16 {
      margin-left: var(--dl-space-space-unit);
      margin-right: var(--dl-space-space-unit);
    }
    .nanny-profile-text17 {
      font-size: 26px;
    }
    .nanny-profile-container08 {
      width: 100%;
    }
    .nanny-profile-container09 {
      width: 100%;
    }
  }
  </style>
  